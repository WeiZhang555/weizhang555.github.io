
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  >
  <head>
<title>Docker官方镜像签名方案：Notary | 长弓二十九</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">





<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="1. TUF 1.1 背景 1.2 TUF的角色 1.2 TUF的工作流 step 0: 加载可信的root元数据文件 step 1: 更新root元数据文件 step 2: 下载timestamp元数据文件 step 3：下载snapshot元数据文件 step 4：下载最顶层的targets元数据 step 5：对 …" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="">
<meta name="twitter:title" content="Docker官方镜像签名方案：Notary" />
<meta name="twitter:image" content="https://weizhang555.github.io/images/thumbnail.png"/>
<meta property="og:url" content="https://weizhang555.github.io/original/notary-intro/" />
<meta property="og:title" content="Docker官方镜像签名方案：Notary" />
<meta property="og:description" content="1. TUF 1.1 背景 1.2 TUF的角色 1.2 TUF的工作流 step 0: 加载可信的root元数据文件 step 1: 更新root元数据文件 step 2: 下载timestamp元数据文件 step 3：下载snapshot元数据文件 step 4：下载最顶层的targets元数据 step 5：对 …" />
<meta property="og:image" content="https://weizhang555.github.io/images/thumbnail.png" />

<link rel="apple-touch-icon" sizes="180x180" href="https://weizhang555.github.io/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://weizhang555.github.io/icons/favicon-32x32.png">
<link rel="manifest" href="https://weizhang555.github.io/icons/site.webmanifest">

<link rel="canonical" href="https://weizhang555.github.io/original/notary-intro/">



<link rel="preload" href="https://weizhang555.github.io/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity = "sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" as="style" crossorigin="anonymous">



<link rel="preload" href="https://weizhang555.github.io/en/js/bundle.bbf6eab9d0e31d2d45a0d302b93cfbdd7c169deb9518a671024c06b869cc688d310d3e3d6f813aade70aa8dfb8f5b467207588efc0b8a721cbeeb3e059b229da.js" as="script" integrity=
"sha512-u/bqudDjHS1FoNMCuTz73XwWneuVGKZxAkwGuGnMaI0xDT49b4E6recKqN&#43;49bRnIHWI78C4pyHL7rPgWbIp2g==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="https://weizhang555.github.io/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity="sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" crossorigin="anonymous">

  </head>
  <body
    data-code="7"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='https://weizhang555.github.io/' class="nav_brand nav_item" title="长弓二十九">长弓二十九
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://weizhang555.github.io/original" class="nav_item" title="原创">原创 </a>
  </div>
  <div class="nav_parent">
    <a href="https://weizhang555.github.io/translate" class="nav_item" title="译文">译文 </a>
  </div>
  <div class="nav_parent">
    <a href="https://weizhang555.github.io/about/" class="nav_item" title="关于">关于 </a>
  </div>
      
<div class='follow'>
  <a href="https://github.com/weizhang555">
    <svg class="icon">
  <title>github</title>
  <use xlink:href="#github"></use>
</svg>

  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">Docker官方镜像签名方案：Notary</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      Dec 11, 2018</span>
    <span class="post_time"> · 4 min read</span><span>&nbsp;· <a href='https://weizhang555.github.io/tags/%E5%AE%B9%E5%99%A8/' title="容器" class="post_tag button button_translucent">容器
        </a><a href='https://weizhang555.github.io/tags/%E5%AE%89%E5%85%A8/' title="安全" class="post_tag button button_translucent">安全
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=Docker%e5%ae%98%e6%96%b9%e9%95%9c%e5%83%8f%e7%ad%be%e5%90%8d%e6%96%b9%e6%a1%88%ef%bc%9aNotary&url=https%3a%2f%2fweizhang555.github.io%2foriginal%2fnotary-intro%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fweizhang555.github.io%2foriginal%2fnotary-intro%2f&t=Docker%e5%ae%98%e6%96%b9%e9%95%9c%e5%83%8f%e7%ad%be%e5%90%8d%e6%96%b9%e6%a1%88%ef%bc%9aNotary" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="https://weizhang555.github.io/original/notary-intro/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

    <div class="post_body"><ul>
<li><a href="#1-tuf">1. TUF</a>
<ul>
<li><a href="#11-%E8%83%8C%E6%99%AF">1.1 背景</a></li>
<li><a href="#12-tuf%E7%9A%84%E8%A7%92%E8%89%B2">1.2 TUF的角色</a></li>
<li><a href="#12-tuf%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81">1.2 TUF的工作流</a>
<ul>
<li><a href="#step-0-%E5%8A%A0%E8%BD%BD%E5%8F%AF%E4%BF%A1%E7%9A%84root%E5%85%83%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6">step 0: 加载可信的root元数据文件</a></li>
<li><a href="#step-1-%E6%9B%B4%E6%96%B0root%E5%85%83%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6">step 1: 更新root元数据文件</a></li>
<li><a href="#step-2-%E4%B8%8B%E8%BD%BDtimestamp%E5%85%83%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6">step 2: 下载timestamp元数据文件</a></li>
<li><a href="#step-3%E4%B8%8B%E8%BD%BDsnapshot%E5%85%83%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6">step 3：下载snapshot元数据文件</a></li>
<li><a href="#step-4%E4%B8%8B%E8%BD%BD%E6%9C%80%E9%A1%B6%E5%B1%82%E7%9A%84targets%E5%85%83%E6%95%B0%E6%8D%AE">step 4：下载最顶层的targets元数据</a></li>
<li><a href="#step-5%E5%AF%B9%E7%85%A7target%E5%85%83%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81target">step 5：对照target元数据验证target</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-notary">2. Notary</a>
<ul>
<li><a href="#21-%E4%BB%8B%E7%BB%8D">2.1 介绍</a></li>
<li><a href="#22-%E7%9B%AE%E6%A0%87">2.2 目标</a></li>
<li><a href="#23-notary%E7%9A%84%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86">2.3 Notary的密钥管理</a></li>
</ul>
</li>
<li><a href="#3-docker-content-trust%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95">3. Docker Content Trust本地测试</a>
<ul>
<li><a href="#31-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">3.1 环境准备</a></li>
<li><a href="#32-push%E7%9A%84%E9%95%9C%E5%83%8F%E6%97%A0%E7%AD%BE%E5%90%8D%E7%9A%84%E6%83%85%E5%86%B5">3.2 push的镜像无签名的情况</a></li>
<li><a href="#33-push%E6%9C%89%E7%AD%BE%E5%90%8D%E7%9A%84%E7%89%88%E6%9C%AC">3.3 push有签名的版本</a></li>
<li><a href="#34-%E6%81%B6%E6%84%8F%E7%94%A8%E6%88%B7%E4%B8%8A%E4%BC%A0%E6%81%B6%E6%84%8F%E9%95%9C%E5%83%8F%E8%A6%86%E7%9B%96ubuntu1804">3.4 恶意用户上传恶意镜像，覆盖ubuntu:18.04</a></li>
</ul>
</li>
<li><a href="#35-docker-content-trust%E7%9A%84%E9%97%AE%E9%A2%98">3.5 docker content trust的问题</a></li>
</ul>
<p><a name="86c05371"></a></p>
<h1 id="1-tuf">1. TUF</h1>
<p><a name="dc7ef395"></a></p>
<h2 id="11-背景">1.1 背景</h2>
<p>TUF是Tor项目设计出的一套安全分发软件更新的框架，Notary是TUF框架的go语言实现，而Docker Content Trust是TUF框架的应用。理清三者关系有助于后续理解。</p>
<p><a name="48d6dd4d"></a></p>
<h2 id="12-tuf的角色">1.2 TUF的角色</h2>
<p>TUF框架包含五类角色，对应五把密钥，分别是Root, Target, Snapshot, Timestamp, Delegated target(可选)，每个角色对应一个元数据文件及一把密钥。</p>
<p>TUF角色和密钥的理解与Notary介绍有重合，可以参考 &quot;2.3 Notary的密钥管理&quot;</p>
<p><a name="6392582b"></a></p>
<h2 id="12-tuf的工作流">1.2 TUF的工作流</h2>
<p>TUF框架的定义在这里：<a href="https://github.com/theupdateframework/specification/blob/master/tuf-spec.md">https://github.com/theupdateframework/specification/blob/master/tuf-spec.md</a> 。</p>
<p><a name="a06a3afc"></a></p>
<h3 id="step-0-加载可信的root元数据文件">step 0: 加载可信的root元数据文件</h3>
<p>这一步可以认为是前奏步骤。一个初始的root元数据文件应该早已经随包管理器交付到客户端，或者通过带外流程放置进去了。此时的root元数据文件的超时不重要，因为下一步会更新它。</p>
<p><a name="297c8ad9"></a></p>
<h3 id="step-1-更新root元数据文件">step 1: 更新root元数据文件</h3>
<p>由于现在元数据文件可能是被完全不同的一组key签名的，客户端必须有办法能持续的更新到最新的密钥，通过不断的下载中间阶段的密钥一直到最新版。</p>
<p><a name="bc108cbc"></a></p>
<h4 id="step-11-使用n代表可信root元数据文件的版本号">step 1.1: 使用N代表可信root元数据文件的版本号</h4>
<p><a name="3a3bc15b"></a></p>
<h4 id="step-12-下载root元数据文件的n1版本">step 1.2: 下载root元数据文件的N+1版本</h4>
<p>文件名是固定的格式：VERSION_NUMBER.FILENAME.EXT (e.g., 42.root.json)。不成功的话跳转到1.8步。</p>
<p><a name="af6407c8"></a></p>
<h4 id="step-13-检查签名">step 1.3: 检查签名</h4>
<p>N+1版的root元数据必须被以下密钥签名：1）N版本root元数据内指定的达到阈值数量的密钥。2）新版本的root元数据里指定的达到阈值数量的密钥。<br />
如果N+1版本的root元数据没有被正确签名，退出并报错。</p>
<p><a name="c82a2500"></a></p>
<h4 id="step-14-检查回滚攻击rollback-attach">step 1.4: 检查回滚攻击(rollback attach)</h4>
<p>当前信任的root元数据文件版本（N）必须小于新的root元数据文件（N+1）。如果不是退出并报错。</p>
<p><a name="499c370d"></a></p>
<h4 id="step-15-新版本元数据文件的超时时间可以忽略18会检查">step 1.5: 新版本元数据文件的超时时间可以忽略，1.8会检查</h4>
<p><a name="772542a8"></a></p>
<h4 id="step-16-设置受信任的root元数据文件为新的元数据文件">step 1.6: 设置受信任的root元数据文件为新的元数据文件</h4>
<p><a name="4acd438c"></a></p>
<h4 id="step-17-重复step-11到17直到root元数据为最新">step 1.7: 重复step 1.1到1.7直到root元数据为最新</h4>
<p><a name="4307b20f"></a></p>
<h4 id="step-18-检查冻结攻击freeze-attach">step 1.8: 检查冻结攻击(freeze attach)</h4>
<p>检查当前的信任的root元数据文件是否过期，过期的报错退出。</p>
<p><a name="6afb0c5e"></a></p>
<h4 id="step-19-如果timestamp和或snapshot密钥已经改变删掉snapshot和timestamp元数据文件">step 1.9: 如果timestamp和/或snapshot密钥已经改变，删掉snapshot和timestamp元数据文件</h4>
<p>这个是为了从快进攻击(fast-forward attach)中恢复出来。快进攻击是攻击者可以任意增加元数据的版本号：1）timestamp元数据。2）snapshot元数据。3）targets元数据。</p>
<p><a name="9f0f7b4c"></a></p>
<h3 id="step-2-下载timestamp元数据文件">step 2: 下载timestamp元数据文件</h3>
<p>下载固定文件名timestamp.json</p>
<p><a name="a95f255d"></a></p>
<h4 id="step-21检查签名">step 2.1：检查签名</h4>
<p>使用可信的root元数据文件里包含的timestamp公钥验证签名。</p>
<p><a name="e1d7dbf4"></a></p>
<h4 id="step-22检查回滚攻击">step 2.2：检查回滚攻击</h4>
<p><a name="8f3bcb1b"></a></p>
<h4 id="step-23检查冻结攻击">step 2.3：检查冻结攻击</h4>
<p><a name="c360aa04"></a></p>
<h3 id="step-3下载snapshot元数据文件">step 3：下载snapshot元数据文件</h3>
<p>如果使能了一致性snapshot，那么文件名就是VERSION_NUMBER.FILENAME.EXT (e.g., 42.snapshot.json)格式，否则就是固定的snapshot.json。</p>
<p><a name="a729d8f4"></a></p>
<h4 id="step-31对照timestamp元数据检查">step 3.1：对照timestamp元数据检查</h4>
<p>新的snapshot元数据文件的hash和版本号必须和timestamp元数据文件里的一致。否则报错并退出。</p>
<p><a name="cec19cb8"></a></p>
<h4 id="step-32检查签名">step 3.2：检查签名</h4>
<p>snapshot元数据文件应该被root元数据文件里面指定的snapshot key正确签名。否则报错退出。</p>
<p><a name="c4edc620"></a></p>
<h4 id="step-33检查回滚攻击">step 3.3：检查回滚攻击</h4>
<p><a name="1a5c6b5d"></a></p>
<h4 id="step-34检查冻结攻击">step 3.4：检查冻结攻击</h4>
<p><a name="689f097e"></a></p>
<h3 id="step-4下载最顶层的targets元数据">step 4：下载最顶层的targets元数据</h3>
<p>下载targets.json</p>
<p><a name="891c54a0"></a></p>
<h4 id="step-41对照snapshot元数据检查">step 4.1：对照snapshot元数据检查</h4>
<p>新的targets元数据文件的hash和版本号必须与可信的snapshot元数据文件内保存的一致。</p>
<p><a name="8205988c"></a></p>
<h4 id="step-42检查任意软件攻击arbitrary-software-attack">step 4.2：检查“任意软件攻击”（arbitrary software attack）</h4>
<p>新的targets元数据文件必须被root元数据文件里指定的targets密钥正确签名，否则报错退出。</p>
<p><a name="160581ac"></a></p>
<h4 id="step-43检查回滚攻击">step 4.3：检查回滚攻击</h4>
<p><a name="4a53d610"></a></p>
<h4 id="step-44检查冻结攻击">step 4.4：检查冻结攻击</h4>
<p><a name="c6f818ad"></a></p>
<h4 id="step-45前序遍历搜索对应的target以最顶层的target角色为起始">step 4.5：前序遍历搜索对应的target，以最顶层的target角色为起始</h4>
<p><em>Note: 前序遍历：按根节点-左子树-右子树的顺序遍历。实际上指的是targets及相应delegation角色构成的数</em></p>
<p><a name="5e4f71e7"></a></p>
<h5 id="step-451-如果节点已经被访问过了那么跳过这个节点以避免访问环路如果角色包含了所需要的target元数据那么跳到step-5">step 4.5.1 如果节点已经被访问过了，那么跳过这个节点以避免访问环路。如果角色包含了所需要的target元数据，那么跳到step 5。</h5>
<p><a name="9bdae3b6"></a></p>
<h5 id="step-452-递归访问delegation列表直到找到相应的targets元数据">step 4.5.2 递归访问delegation列表，直到找到相应的targets元数据。</h5>
<p><a name="fab2be30"></a></p>
<h3 id="step-5对照target元数据验证target">step 5：对照target元数据验证target</h3>
<p><a name="5080d61d"></a></p>
<h4 id="step-51找到对应的target元数据报错退出">step 5.1：找到对应的target元数据，报错退出</h4>
<p><a name="ca58b5a0"></a></p>
<h4 id="step-52否则下载相应的target验证hash是否与target元数据里的匹配">step 5.2：否则下载相应的target，验证hash是否与target元数据里的匹配。</h4>
<p><a name="d61a8569"></a></p>
<h1 id="2-notary">2. Notary</h1>
<p><a name="7e9e013a"></a></p>
<h2 id="21-介绍">2.1 介绍</h2>
<p>Notary一个client和一个server组件。<br />
它意图为用户创建一个易用的内容分发和验证系统，TLS本身可以用于加密同web server的安全通道，但是当server沦陷的时候，恶意用户可以轻易的将合法内容替换成非法内容。<br />
使用notary，用户可以用自己妥善保管的<strong>线下</strong>密钥签名他们的内容，然后发布它的签民的可信内容到他的notary server。<br />
内容的使用者，通常事先获取了内容发布者的公钥，可以与Notary server通信来验证内容的合法性和完整性。</p>
<p><a name="83de0e71"></a></p>
<h2 id="22-目标">2.2 目标</h2>
<p>Notary的实现基于TUF(The Update Framework)，TUF是软件安全发布与升级的通用设计。借助TUF，Notary可以获得一些关键优势：</p>
<ol>
<li>抗密钥泄漏。内容发布者必须使用密钥来签名内容，镜像签名系统必须保证密钥泄露之后系统可以恢复。TUF使用分层次的多把密钥，可以保证密钥泄漏不会影响。</li>
<li>新鲜性保证。<strong>重放攻击</strong>是常见的攻击手段，攻击者可以将老的拥有合法签名的软件包伪装成最新的软件包发布给客户，这些旧软件包可能包含漏洞。Notary使用时间戳来保证内容使用者收到的是最新的内容。</li>
<li>可配置的信任阈值。经常有一种情形是允许多个发布者发布同一份内容，比如某个项目的多个maintainers。使用信任阈值可以保证只有一定数量的发布者同时签名一份文件他才可以被信任，这样可以保证单独的一份密钥泄漏不会允许恶意内容被发布出去。（Q: 听上去很好，怎么用？一把用户key，一把ci key？）</li>
<li>签名授权。内容发布者可以将自己的部分可信内容集合授权给另一个签名者。</li>
<li>使用现有的发布渠道。Notary不需要和任何特殊的发布通道绑定。</li>
<li>不信任的Mirrors和传输。Notary的元数据可以通过任意的镜像或者通道传输。</li>
</ol>
<p><a name="201b407d"></a></p>
<h2 id="23-notary的密钥管理">2.3 Notary的密钥管理</h2>
<p>TUF的密钥是分角色的，不同的密钥有不同的特性和功能。</p>
<p><figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt=""
      
        class="image_figure image_external image_svg image_unprocessed"
        src="https://camo.githubusercontent.com/c4166122f8b4e908ad9d59421072ea1f64074a9d/68747470733a2f2f63646e2e7261776769742e636f6d2f7468657570646174656672616d65776f726b2f6e6f746172792f303966383137313730383066353332373665363838316563653537636262626639316238653261372f646f63732f696d616765732f6b65792d6869657261726368792e737667#alt=TUF%E5%AF%86%E9%92%A5%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"
      
      
    />

    </picture>
</figure>
</p>
<ul>
<li><em>Root key</em>: 用来签名root元数据，root元数据存储了root，targets，snapshot和timestamp<strong>公钥</strong>的ID。客户可以用这些公钥来验证所有的元数据文件的签名。root key极其重要，建议离线存放，比如存在yubi key硬件里面。它的过期时间应该也是最长的，比如10年。</li>
<li><em>Snapshot key</em>：用来签名snapshot元数据，snapshot元数据列举了<strong>集合</strong>[注1]的root，targets和delegation元数据文件的文件名大小和hash，它用于验证其他元数据文件的完整性。可以给<strong>集合</strong>的拥有者保存，也可以给notary service保存。</li>
<li><em>timestamp key</em>: 签名timestamp元数据，timestamp元数据通过给元数据指定最小超时时间，以及指定最新的snapshot的文件名大小hash值等来保证时效性。它用来验证snapshot文件的完整性。timestamp密钥由notary service保存，它可以自动重新生成而不需要集合的拥有者参与。有效期应该最短，比如14天。</li>
<li><em>target key</em>：签名target元数据，target元数据列举了集合内的文件名，大小及相应的hash，这个文件用来验证repository的实际内容的完整性。也用来给其他的合作者授权。这个key由拥有者持有。有效期中等，比如3年。</li>
<li><em>Delegation key</em>：用于签名delegation元数据，delegation元数据列举了集合文件名，大小及hash。这个key与target key实际上是相似的，也可以授权给下一级合作者。</li>
</ul>
<p>注：<br />
[1] .集合：docker content trust里面实际上是image名字，集合是tag的集合，</p>
<p>加一张图方便理解：</p>
<p><figure>
  <picture>

    
      
        
        
        
        
        
        
    <img
      loading="lazy"
      decoding="async"
      alt=""
      
        class="image_figure image_external image_processed"
        width="807"
        height="502"
        src="/images/1559546664194-9306b7f5-5264-4fea-9539-34c6faf2de4f_6217806691758195335.png"
      
      
    />

    </picture>
</figure>
</p>
<p><a name="0cf97d05"></a></p>
<h1 id="3-docker-content-trust本地测试">3. Docker Content Trust本地测试</h1>
<p><a name="9819535e"></a></p>
<h2 id="31-环境准备">3.1 环境准备</h2>
<ol>
<li>启动本地registry</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d -p 5000:5000 registry:2.4.1
</span></span></code></pre></div><ol start="2">
<li>启动notary</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="nb">cd</span> notary-src-dir
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker-compose up -d
</span></span></code></pre></div><ol start="3">
<li>导出环境变量</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="nb">export</span> <span class="nv">REGISTRY</span><span class="o">=</span>localhost:5000
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST_SERVER</span><span class="o">=</span>https://localhost:4443
</span></span></code></pre></div><p><a name="7c41bc76"></a></p>
<h2 id="32-push的镜像无签名的情况">3.2 push的镜像无签名的情况</h2>
<p>先pull一个测试用的镜像：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker pull ubuntu:18.04
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker images ubuntu:18.04
</span></span><span class="line"><span class="ln">3</span><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="ln">4</span><span class="cl">ubuntu              18.04               7698f282e524        <span class="m">12</span> days ago         69.9MB
</span></span><span class="line"><span class="ln">5</span><span class="cl">$ docker tag ubuntu:18.04 <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span></code></pre></div><p>先把不使用notary签名的版本搞上去。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker push <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span></code></pre></div><p>本地删除镜像，然后分别用支持Notary和不支持notary的方式pull一下试试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ docker rmi -f 7698f282e524
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">$ docker pull <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Error: remote trust data does not exist <span class="k">for</span> localhost:5000/test/ubuntu: localhost:4443 does not have trust data <span class="k">for</span> localhost:5000/test/ubuntu
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">$ docker pull <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">18.04: Pulling from test/ubuntu
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">6abc03819f3e: Pull <span class="nb">complete</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">05731e63f211: Pull <span class="nb">complete</span> 
</span></span><span class="line"><span class="ln">10</span><span class="cl">0bd67c50d6be: Pull <span class="nb">complete</span> 
</span></span><span class="line"><span class="ln">11</span><span class="cl">Digest: sha256:b36667c98cf8f68d4b7f1fb8e01f742c2ed26b5f0c965a788e98dfe589a4b3e4
</span></span><span class="line"><span class="ln">12</span><span class="cl">Status: Downloaded newer image <span class="k">for</span> localhost:5000/test/ubuntu:18.04
</span></span></code></pre></div><p>可以看到如果用户上次的image没有被notary签名过，那么当客户端指定enable了content trust之后，是无法pull不可信的image的。</p>
<p><a name="dfe9a5b0"></a></p>
<h2 id="33-push有签名的版本">3.3 push有签名的版本</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ docker push <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">The push refers to repository <span class="o">[</span>localhost:5000/test/ubuntu<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">8d267010480f: Layer already exists 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">270f934787ed: Layer already exists 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">02571d034293: Layer already exists 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">18.04: digest: sha256:b36667c98cf8f68d4b7f1fb8e01f742c2ed26b5f0c965a788e98dfe589a4b3e4 size: <span class="m">943</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Signing and pushing trust metadata
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">You are about to create a new root signing key passphrase. This passphrase
</span></span><span class="line"><span class="ln">10</span><span class="cl">will be used to protect the most sensitive key in your signing system. Please
</span></span><span class="line"><span class="ln">11</span><span class="cl">choose a long, complex passphrase and be careful to keep the password and the
</span></span><span class="line"><span class="ln">12</span><span class="cl">key file itself secure and backed up. It is highly recommended that you use a
</span></span><span class="line"><span class="ln">13</span><span class="cl">password manager to generate the passphrase and keep it safe. There will be no
</span></span><span class="line"><span class="ln">14</span><span class="cl">way to recover this key. You can find the key in your config directory.
</span></span><span class="line"><span class="ln">15</span><span class="cl">Enter passphrase <span class="k">for</span> new root key with ID 74088e3: 
</span></span><span class="line"><span class="ln">16</span><span class="cl">Repeat passphrase <span class="k">for</span> new root key with ID 74088e3: 
</span></span><span class="line"><span class="ln">17</span><span class="cl">Enter passphrase <span class="k">for</span> new repository key with ID 5e28dca: 
</span></span><span class="line"><span class="ln">18</span><span class="cl">Repeat passphrase <span class="k">for</span> new repository key with ID 5e28dca: 
</span></span><span class="line"><span class="ln">19</span><span class="cl">Finished initializing <span class="s2">&#34;localhost:5000/test/ubuntu&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">Successfully signed localhost:5000/test/ubuntu:18.04
</span></span></code></pre></div><p>可以看到push成功了之后会在给notary做一次签名。</p>
<p>此时客户端可以成功pull，不论CONTENT_TRUST是否enble，签名检查对用户是透明的。</p>
<p>使用以下命令可以撤销对image的签名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker trust revoke <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span></code></pre></div><p><a name="b7518625"></a></p>
<h2 id="34-恶意用户上传恶意镜像覆盖ubuntu1804">3.4 恶意用户上传恶意镜像，覆盖ubuntu:18.04</h2>
<p>先使用如下Dockerfile制作一个恶意image：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">FROM localhost:5000/test/ubuntu:18.04
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">MAINTAINER black-hat
</span></span><span class="line"><span class="ln">4</span><span class="cl">RUN apt update <span class="o">&amp;&amp;</span> apt install -y sl
</span></span><span class="line"><span class="ln">5</span><span class="cl">CMD <span class="o">[</span><span class="s2">&#34;/usr/games/sl&#34;</span><span class="o">]</span>
</span></span></code></pre></div><p>制作image的命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker build -t ubuntu:evil .
</span></span></code></pre></div><p>这个镜像run起来之后会有一个小火车跑过:-)</p>
<p>我们切换一个账户，尝试用普通账户签名并且覆盖原先的ubuntu:18.04</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ su - <span class="nb">test</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ <span class="nb">export</span> <span class="nv">REGISTRY</span><span class="o">=</span>localhost:5000
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST_SERVER</span><span class="o">=</span>https://localhost:4443
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">$ docker tag ubuntu:evil <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">$ docker push <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">The push refers to repository <span class="o">[</span>localhost:5000/test/ubuntu<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">0f5d6ef7110f: Pushed 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">8d267010480f: Layer already exists 
</span></span><span class="line"><span class="ln">10</span><span class="cl">270f934787ed: Layer already exists 
</span></span><span class="line"><span class="ln">11</span><span class="cl">02571d034293: Layer already exists 
</span></span><span class="line"><span class="ln">12</span><span class="cl">18.04: digest: sha256:8ff78797f8ce02027d187f3a0c27502e134aa18163c62e110001e11b1a95b36d size: <span class="m">1155</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">Signing and pushing trust metadata
</span></span><span class="line"><span class="ln">14</span><span class="cl">ERRO<span class="o">[</span>0002<span class="o">]</span> couldn<span class="err">&#39;</span>t add target to targets: could not find necessary signing keys, at least one of these keys must be available: 5e28dcaf218a140b6eeb8af239c2c44a2fbc7103d41759b5bc7aeaa3b7a5ec4e 
</span></span><span class="line"><span class="ln">15</span><span class="cl">failed to sign localhost:5000/test/ubuntu:18.04: could not find necessary signing keys, at least one of these keys must be available: 5e28dcaf218a140b6eeb8af239c2c44a2fbc7103d41759b5bc7aeaa3b7a5ec4e
</span></span></code></pre></div><p>可以看到由于这个用户由于没有合法的密钥，是无法给image做签名的。但是镜像上传成功了。这部分理论上应该有registry的身份认证拦截。</p>
<p>我们切换回root用户，把本地镜像删除了，禁用content trust之后再来试一次。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo su
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker rmi -f <span class="sb">`</span>docker images ubuntu:evil -q<span class="sb">`</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ docker rmi -f <span class="sb">`</span>docker images <span class="nv">$REGISTRY</span>/test/ubuntu -q<span class="sb">`</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">$ docker run -ti <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span></code></pre></div><p>可以看到小火车跑过，证明本地的image下载的是恶意的。<br />
重新删除，然后再带Content Trust试一下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker rmi -f <span class="sb">`</span>docker images <span class="nv">$REGISTRY</span>/test/ubuntu -q<span class="sb">`</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ <span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ docker pull <span class="nv">$REGISTRY</span>/test/ubuntu:18.04
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># docker pull $REGISTRY/test/ubuntu:18.04</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">No valid trust data <span class="k">for</span> 18.04
</span></span></code></pre></div><p>可见这个image已经不被信任了，无法pull和运行非法image。</p>
<p><a name="a1628df4"></a></p>
<h1 id="35-docker-content-trust的问题">3.5 docker content trust的问题</h1>
<ol>
<li>镜像是先与Registry打交道后存储签名，如果是恶意image覆盖的问题，会导致恶意image上传上去了，但是签名没有更新/被删除的问题，导致image和notary签名数据不一致。需要加事务来解决？</li>
<li>密钥的存储必须与KMS结合起来，这样就不能直接使用docker+notary的解决方案了，预计要重新实现docker client的签名和验证功能?</li>
</ol>

    </div>
<div class="post_comments">
  
  
    
 <script src="https://utteranc.es/client.js"
         repo="weizhang555/weizhang555.github.io"
         issue-term="title"
         theme="github-light"
         
         label="blog comments ✨💬✨"
         
         crossorigin="anonymous"
         async>
 </script>
 
  
  
</div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    
  
  <div class="search">
    <input type="search" class="search_field form_field" placeholder='Search...' id="find" autocomplete="off" data-scope='original'>
    <label for="find" class="search_label"><svg class="icon">
  <title>search</title>
  <use xlink:href="#search"></use>
</svg>

    </label>
    
    <div class="search_results results"></div>
  </div>

        <h2>张伟[weizhang555]</h2>
      <div class="author_bio">
        一个简简单单的技术人.</br>Live long and prosper!
      </div>
      <a href='https://weizhang555.github.io/about/' class="button mt-1" role="button" title='Read More'>Read More</a>

    
    
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://weizhang555.github.io/translate/bpf-design-qa/" class="nav-link" title="BPF的设计原则Q&amp;A">BPF的设计原则Q&amp;A</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/different-software-types/" class="nav-link" title="你的软件是“椰子”还是“苹果”？">你的软件是“椰子”还是“苹果”？</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/runc-host-escape-cve/" class="nav-link" title="docker-runc主机逃逸漏洞复现：CVE-2019-5736">docker-runc主机逃逸漏洞复现：CVE-2019-5736</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/kubernetes-setup/" class="nav-link" title="kubernetes安装指南">kubernetes安装指南</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/notary-intro/" class="nav-link" title="Docker官方镜像签名方案：Notary">Docker官方镜像签名方案：Notary</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/create-k8s-cluster-with-kata/" class="nav-link" title="创建kata的K8s集群">创建kata的K8s集群</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/make-initramfs-for-qemu-start/" class="nav-link" title="Kernel调试基础--制作initramfs">Kernel调试基础--制作initramfs</a>
      </li>
      <li>
        <a href="https://weizhang555.github.io/original/kata-containers-introduction/" class="nav-link" title="Kata Containers介绍，附上演讲ppt">Kata Containers介绍，附上演讲ppt</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://weizhang555.github.io/categories/%E8%AF%91%E6%96%87/' class="post_tag button button_translucent" title="译文">
          译文
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://weizhang555.github.io/tags/%E5%AE%B9%E5%99%A8/' class="post_tag button button_translucent" title="容器">
          容器
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/%E5%AE%89%E5%85%A8/' class="post_tag button button_translucent" title="安全">
          安全
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/k8s/' class="post_tag button button_translucent" title="k8s">
          K8S
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/bpf/' class="post_tag button button_translucent" title="bpf">
          BPF
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/kata/' class="post_tag button button_translucent" title="kata">
          KATA
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/linux-kernel/' class="post_tag button button_translucent" title="linux-kernel">
          LINUX-KERNEL
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/runc/' class="post_tag button button_translucent" title="runc">
          RUNC
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/%E5%86%85%E6%A0%B8/' class="post_tag button button_translucent" title="内核">
          内核
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://weizhang555.github.io/tags/%E9%9A%8F%E6%89%8B/' class="post_tag button button_translucent" title="随手">
          随手
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 18" id="mastodon">
    <path
    fill="#ffffff"
    d="m 15.054695,9.8859583 c -0.22611,1.1632697 -2.02517,2.4363497 -4.09138,2.6830797 -1.0774504,0.12856 -2.1382704,0.24673 -3.2694704,0.19484 -1.84996,-0.0848 -3.30971,-0.44157 -3.30971,-0.44157 0,0.1801 0.0111,0.35157 0.0333,0.51194 0.24051,1.82571 1.81034,1.93508 3.29737,1.98607 1.50088,0.0514 2.8373104,-0.37004 2.8373104,-0.37004 l 0.0617,1.35686 c 0,0 -1.0498104,0.56374 -2.9199404,0.66742 -1.03124,0.0567 -2.3117,-0.0259 -3.80308,-0.42069 -3.23454998,-0.85613 -3.79081998,-4.304 -3.87592998,-7.8024197 -0.026,-1.03871 -0.01,-2.01815 -0.01,-2.83732 0,-3.57732 2.34385998,-4.62587996 2.34385998,-4.62587996 1.18184,-0.54277 3.20976,-0.77101 5.318,-0.7882499985409 h 0.0518 C 9.8267646,0.01719834 11.856025,0.24547834 13.037775,0.78824834 c 0,0 2.34377,1.04855996 2.34377,4.62587996 0,0 0.0294,2.63937 -0.32687,4.47183"/>
 <path
    fill="#000000"
    d="m 12.616925,5.6916583 v 4.3315297 h -1.71607 V 5.8189683 c 0,-0.88624 -0.37289,-1.33607 -1.1187604,-1.33607 -0.82467,0 -1.23799,0.53361 -1.23799,1.58875 v 2.30122 h -1.70594 v -2.30122 c 0,-1.05514 -0.4134,-1.58875 -1.23808,-1.58875 -0.74587,0 -1.11876,0.44983 -1.11876,1.33607 v 4.2042197 h -1.71607 V 5.6916583 c 0,-0.88527 0.22541,-1.58876 0.67817,-2.10922 0.46689,-0.52047 1.07833,-0.78727 1.83735,-0.78727 0.87816,0 1.54317,0.33752 1.98288,1.01267 l 0.42744,0.71655 0.42753,-0.71655 c 0.43961,-0.67515 1.10463,-1.01267 1.9828704,-1.01267 0.75893,0 1.37037,0.2668 1.83735,0.78727 0.45268,0.52046 0.67808,1.22395 0.67808,2.10922"/>
  </symbol>
</svg>

<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://weizhang555.github.io/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="Copyright © 2021 Zhang Wei">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;COPYRIGHT © 2021 ZHANG WEI. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="https://weizhang555.github.io/en/js/bundle.bbf6eab9d0e31d2d45a0d302b93cfbdd7c169deb9518a671024c06b869cc688d310d3e3d6f813aade70aa8dfb8f5b467207588efc0b8a721cbeeb3e059b229da.js" integrity="sha512-u/bqudDjHS1FoNMCuTz73XwWneuVGKZxAkwGuGnMaI0xDT49b4E6recKqN&#43;49bRnIHWI78C4pyHL7rPgWbIp2g==" crossorigin="anonymous"></script>

  <script src="https://weizhang555.github.io/js/search.min.b19f217359693afb8f0abd75ca8de6becceec41f5304950fc48e165914ef227f44d10005d02a281a66e33b482e2ff27e6eb893111505deb4f072c307e1f887bb.js"></script>

  </body>
</html>
